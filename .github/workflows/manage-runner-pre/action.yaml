name: Setup runner
description: Reusable action for setting up the github runner

inputs:
  aws_access_key_id:
    description: 'AWS Access Key ID'
    required: true
  aws_secret_access_key:
    description: 'AWS Secret Access Key'
    required: true

runs:
  using: composite
  steps:
    - name: "👮‍♀️ Setup runner"
      shell: bash
      run: |
        set -euo pipefail
        sudo chown -R 1001:1001 ~/.cache
        echo "Changed ownership of cache to 1001:1001"

    ########################################
    # Setup
    ########################################
    - uses: bazelbuild/setup-bazelisk@v2
    
    - name: "🧹 Clean bazel cache if we're preparing a new release"
      if: ${{ startsWith(github.ref, 'refs/tags/v') }}
      # This is desirable to make sure bazel does not use stale pre-built binaries
      # Bazel actually keeps all intermediate objects so builds are still fast
      run: bazel clean
      shell: bash
        